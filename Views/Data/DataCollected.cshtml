@model List<FYP.Models.Ticket>
@{
    Layout = "_Ticket";
}

<!DOCTYPE html>
<html>
<head>
    <title>Ticket Data Collection</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <canvas id="ticketChart"></canvas>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Table data
            var ticketData = [
                {
                    ticket_id: 1,
                    username: 'william',
                    userid: 2387,
                    description: 'laptop blue screen out of a sudden',
                    category_id: 2,
                    status_id: 2,
                    datetime: '2023-03-08',
                    priority_id: 2,
                    employee_id: 124,
                    devices_involved: 'laptop',
                    additional_details: null
                },
                {
                    ticket_id: 2,
                    username: 'joan',
                    userid: 20124812,
                    description: 'network unstable',
                    category_id: 3,
                    status_id: 1,
                    datetime: '2023-01-18',
                    priority_id: 3,
                    employee_id: 10057,
                    devices_involved: null,
                    additional_details: null
                }
            ];

            // Extract priority IDs and their frequencies
            var priorityFrequencies = ticketData.reduce(function (acc, ticket) {
                var priorityId = ticket.priority_id;
                if (acc.hasOwnProperty(priorityId)) {
                    acc[priorityId]++;
                } else {
                    acc[priorityId] = 1;
                }
                return acc;
            }, {});

            // Convert frequencies object to arrays for labels and data
            var priorityLabels = Object.keys(priorityFrequencies);
            var priorityCounts = Object.values(priorityFrequencies);

            // Render bar chart
            var ticketChart = new Chart(document.getElementById('ticketChart'), {
                type: 'bar',
                data: {
                    labels: priorityLabels,
                    datasets: [{
                        label: 'Priority Count',
                        data: priorityCounts,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            stepSize: 1
                        }
                    }
                }
            });

        });
    </script>
</body>
</html>
